# Обновления: Севастополь и CSV экспорт

Дата: 2025-01-27

## Выполненные изменения

### 1. Добавление Севастополя (ID 96) в парсер цен

#### Обновленные файлы:
- **config.py**: Добавлен ID 96 в список `default_regions`
- **regional_parser.py**: Обновлены fallback значения для популярных регионов
- **regions.md**: Изменен ID Севастополя с 85 на 96
- **generate_regions.py**: Обновлен ID в списке известных регионов
- **REGIONS_INTEGRATION.md**: Обновлен список популярных регионов
- **README.md**: Обновлены примеры и документация
- **REGIONAL_PARSING_GUIDE.md**: Обновлена документация

#### Изменения в конфигурации:
```python
# До:
"default_regions": [77, 78, 50, 40, 23, 66]  # Москва, СПб, Московская, Курская, Краснодар, Свердловская

# После:
"default_regions": [77, 78, 50, 40, 23, 66, 96]  # Москва, СПб, Московская, Курская, Краснодар, Свердловская, Севастополь
```

### 2. Удаление ненужных листов из Excel отчета

#### Удаленные листы:
- "Дорогие регионы АИ-95"
- "Дешевые регионы АИ-95"

#### Оставшиеся листы:
- "Цены по регионам" (основные данные)
- "Статистика по топливу"
- "Общая информация"

### 3. Добавление поддержки CSV экспорта

#### Новые функции:

**В regional_parser.py:**
- `save_regional_csv_report(results, filename)` - создает CSV отчет с региональными ценами
- Обновлена `save_regional_data(results)` для автоматического сохранения в CSV

**В src/utils.py:**
- `export_summary_csv_report(df, output_dir)` - экспорт сводного отчета в CSV файлы
- `export_combined_report(df, output_base)` - комбинированный экспорт (Excel + CSV)

#### Создаваемые CSV файлы:

**Региональный парсер:**
- `regional_prices_{timestamp}.csv` - основные данные по регионам

**Общий анализ данных:**
- `general_stats_{timestamp}.csv` - общая статистика
- `fuel_stats_{timestamp}.csv` - статистика по типам топлива
- `network_stats_{timestamp}.csv` - статистика по сетям АЗС
- `expensive_cities_{timestamp}.csv` - самые дорогие города
- `ai95_network_comparison_{timestamp}.csv` - сравнение сетей по АИ-95
- `cheapest_ai95_stations_{timestamp}.csv` - самые дешевые АЗС для АИ-95
- `all_stations_data_{timestamp}.csv` - полные данные по всем станциям

## Технические детали

### Формат CSV файлов:
- Кодировка: `utf-8-sig` (поддержка BOM для корректного отображения в Excel)
- Разделитель: запятая
- Сортированные колонки для лучшей читаемости

### Структура данных CSV для регионального парсера:
```csv
region_id,region_name,timestamp,url,status,АИ-92,АИ-92+,АИ-95,АИ-95+,АИ-98,АИ-98+,АИ-100,ДТ,ДТ+,Газ,Пропан
96,Севастополь,2025-01-27 12:00:00,https://russiabase.ru/prices?region=96,success,55.5,57.2,59.8,61.5,69.2,71.0,85.5,68.9,70.5,35.2,28.5
```

## Использование

### Региональный парсер:
```bash
# Парсинг популярных регионов (включая Севастополь)
python3 regional_parser.py --popular-regions

# Парсинг конкретного региона (Севастополь)
python3 regional_parser.py --regions 96
```

### Экспорт в CSV через utils:
```python
from src.utils import DataProcessor

# Комбинированный экспорт (Excel + CSV)
DataProcessor.export_combined_report(df, "analysis_report")

# Только CSV
DataProcessor.export_summary_csv_report(df, "csv_reports")
```

## Результат

После внесения изменений:
1. ✅ Севастополь (ID 96) добавлен в список популярных регионов для парсинга
2. ✅ Excel отчеты стали более компактными (убраны ненужные листы)
3. ✅ Все выгрузки теперь сохраняются дополнительно в CSV формате
4. ✅ Обновлена документация во всех релевантных файлах
5. ✅ Сохранена обратная совместимость

## Файлы затронутые изменениями

1. `config.py` - основная конфигурация
2. `regional_parser.py` - региональный парсер
3. `src/utils.py` - утилиты для анализа данных
4. `regions.md` - таблица регионов
5. `generate_regions.py` - генератор регионов
6. `REGIONS_INTEGRATION.md` - документация интеграции
7. `README.md` - основная документация
8. `REGIONAL_PARSING_GUIDE.md` - руководство по парсингу